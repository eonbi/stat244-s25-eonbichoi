<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eonbi Choi &amp; Yerim Oh">
<meta name="dcterms.date" content="2025-05-07">

<title>STAT 244-SC Final Paper – Eonbi’s website for STAT 244</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Eonbi’s website for STAT 244</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./stat_244_sc.html"> 
<span class="menu-text">STAT 244-SC</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./final_paper.html" aria-current="page"> 
<span class="menu-text">STAT 244-SC Final Paper</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#f1-miami-grand-prix-2024-pit-stop-analysis" id="toc-f1-miami-grand-prix-2024-pit-stop-analysis" class="nav-link active" data-scroll-target="#f1-miami-grand-prix-2024-pit-stop-analysis">F1 Miami Grand Prix 2024 Pit Stop Analysis</a>
  <ul class="collapse">
  <li><a href="#abstract" id="toc-abstract" class="nav-link" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#variables-of-interest" id="toc-variables-of-interest" class="nav-link" data-scroll-target="#variables-of-interest">Variables of interest</a></li>
  <li><a href="#missing-data-in-lap_time" id="toc-missing-data-in-lap_time" class="nav-link" data-scroll-target="#missing-data-in-lap_time">Missing Data in <code>lap_time</code></a></li>
  <li><a href="#exploratory-data-analysis-visualization" id="toc-exploratory-data-analysis-visualization" class="nav-link" data-scroll-target="#exploratory-data-analysis-visualization"><strong>Exploratory Data Analysis &amp; Visualization</strong></a></li>
  </ul></li>
  <li><a href="#linear-regression-model" id="toc-linear-regression-model" class="nav-link" data-scroll-target="#linear-regression-model">Linear Regression Model</a>
  <ul class="collapse">
  <li><a href="#research-questions" id="toc-research-questions" class="nav-link" data-scroll-target="#research-questions">Research questions</a></li>
  <li><a href="#linear-models" id="toc-linear-models" class="nav-link" data-scroll-target="#linear-models">Linear Models</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross Validation</a>
  <ul class="collapse">
  <li><a href="#dividing-data-into-test-set-and-training-set" id="toc-dividing-data-into-test-set-and-training-set" class="nav-link" data-scroll-target="#dividing-data-into-test-set-and-training-set">Dividing data into test set and training set</a></li>
  <li><a href="#error-metric-to-use" id="toc-error-metric-to-use" class="nav-link" data-scroll-target="#error-metric-to-use">Error metric to use</a></li>
  </ul></li>
  <li><a href="#k-fold-cv-implementation-for-different-values-of-k" id="toc-k-fold-cv-implementation-for-different-values-of-k" class="nav-link" data-scroll-target="#k-fold-cv-implementation-for-different-values-of-k">k-fold CV implementation for different values of k</a>
  <ul class="collapse">
  <li><a href="#case-1-k5" id="toc-case-1-k5" class="nav-link" data-scroll-target="#case-1-k5">Case 1: k=5</a></li>
  <li><a href="#case-2-k10" id="toc-case-2-k10" class="nav-link" data-scroll-target="#case-2-k10">Case 2: k=10</a></li>
  <li><a href="#case-3-k-20" id="toc-case-3-k-20" class="nav-link" data-scroll-target="#case-3-k-20">Case 3: k = 20</a></li>
  <li><a href="#comparison-between-different-values-of-k" id="toc-comparison-between-different-values-of-k" class="nav-link" data-scroll-target="#comparison-between-different-values-of-k">Comparison between different values of k</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#logistic-regression-model" id="toc-logistic-regression-model" class="nav-link" data-scroll-target="#logistic-regression-model">Logistic Regression Model</a>
  <ul class="collapse">
  <li><a href="#variables-of-interest-1" id="toc-variables-of-interest-1" class="nav-link" data-scroll-target="#variables-of-interest-1">Variables of Interest</a>
  <ul class="collapse">
  <li><a href="#predictors" id="toc-predictors" class="nav-link" data-scroll-target="#predictors">Predictors:</a></li>
  <li><a href="#response-variable" id="toc-response-variable" class="nav-link" data-scroll-target="#response-variable">Response Variable:</a></li>
  </ul></li>
  <li><a href="#our-logistic-regression-model" id="toc-our-logistic-regression-model" class="nav-link" data-scroll-target="#our-logistic-regression-model">Our Logistic Regression Model</a>
  <ul class="collapse">
  <li><a href="#interpretation-of-exponentiated-hatbeta-coefficients" id="toc-interpretation-of-exponentiated-hatbeta-coefficients" class="nav-link" data-scroll-target="#interpretation-of-exponentiated-hatbeta-coefficients">Interpretation of exponentiated <span class="math inline">\(\hat{\beta}\)</span> coefficients</a></li>
  <li><a href="#predicting-high-probability-of-a-pit-stop" id="toc-predicting-high-probability-of-a-pit-stop" class="nav-link" data-scroll-target="#predicting-high-probability-of-a-pit-stop">Predicting High Probability of a Pit Stop</a></li>
  <li><a href="#predicting-pit-stops-with-our-logistic-regression-model" id="toc-predicting-pit-stops-with-our-logistic-regression-model" class="nav-link" data-scroll-target="#predicting-pit-stops-with-our-logistic-regression-model">Predicting Pit Stops with our Logistic Regression Model</a></li>
  </ul></li>
  <li><a href="#proscons-of-logistic-regression-vs.-regular-linear-regression" id="toc-proscons-of-logistic-regression-vs.-regular-linear-regression" class="nav-link" data-scroll-target="#proscons-of-logistic-regression-vs.-regular-linear-regression">Pros/Cons of logistic regression vs.&nbsp;regular linear regression</a>
  <ul class="collapse">
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic Regression</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STAT 244-SC Final Paper</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Eonbi Choi &amp; Yerim Oh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="f1-miami-grand-prix-2024-pit-stop-analysis" class="level1">
<h1>F1 Miami Grand Prix 2024 Pit Stop Analysis</h1>
<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>In sports, data is collected to record athletes’ performances, which helps in making decisions to improve outcomes. In Formula 1 and other motorsports, tire management plays an important role in race strategy. Tires directly impact car performance as they are in contact with the track and transfers all the car’s power and movements to the track surface. Tire degradation influences major decisions such as pit stop timing during a race, where minor misjudgments can result in serious consequences in a fast-paced sports like Formula 1. Our study evaluates the relationship between pit stop laps and tire and lap information though employing linear regression models, cross validation, k-fold cross validation, and logistic regression. The objective is to improve pit stop timing prediction to facilitate effective strategic planning for optimizing pit stop timing, ultimately giving drivers a decisive advantage in race management.</p>
</section>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<p>The data used in this study were obtained from the f1dataR R package that accesses Formula 1 data via the <a href="https://docs.fastf1.dev/">FastF1 Python library</a>. The dataset includes lap-by-lap session data from the 2024 Miami Grand Prix and comprise 1,111 laps and 32 variables. These variables include driver details, lap times, pit in/out times, tire information, and track status. More detailed information about this package can be found in its <a href="https://cran.r-project.org/web/packages/f1dataR/f1dataR.pdf">API documentation</a>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
   time driver driver_number lap_time lap_number stint pit_out_time pit_in_time
  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
1 3438. VER    1                 94.3          1     1          NaN         NaN
2 3531. VER    1                 93.1          2     1          NaN         NaN
3 3624. VER    1                 93.1          3     1          NaN         NaN
4 3717. VER    1                 93.5          4     1          NaN         NaN
5 3810. VER    1                 92.8          5     1          NaN         NaN
6 3903. VER    1                 92.9          6     1          NaN         NaN
# ℹ 24 more variables: sector1time &lt;dbl&gt;, sector2time &lt;dbl&gt;, sector3time &lt;dbl&gt;,
#   sector1session_time &lt;dbl&gt;, sector2session_time &lt;dbl&gt;,
#   sector3session_time &lt;dbl&gt;, speed_i1 &lt;dbl&gt;, speed_i2 &lt;dbl&gt;, speed_fl &lt;dbl&gt;,
#   speed_st &lt;dbl&gt;, is_personal_best &lt;list&gt;, compound &lt;chr&gt;, tyre_life &lt;dbl&gt;,
#   fresh_tyre &lt;lgl&gt;, team &lt;chr&gt;, lap_start_time &lt;dbl&gt;, lap_start_date &lt;dttm&gt;,
#   track_status &lt;chr&gt;, position &lt;dbl&gt;, deleted &lt;lgl&gt;, deleted_reason &lt;chr&gt;,
#   fast_f1generated &lt;lgl&gt;, is_accurate &lt;lgl&gt;, session_type &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="variables-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="variables-of-interest">Variables of interest</h2>
<section id="numerical-variables" class="level4">
<h4 class="anchored" data-anchor-id="numerical-variables">Numerical variables:</h4>
<ul>
<li><p><code>lap_time</code>: Recorded time to complete a lap (seconds)</p></li>
<li><p><code>lap_number</code>: Lap number from which the telemetry data was recorded (number of laps)</p></li>
<li><p><code>tyre_life</code>: Number of laps completed on a set of tires (number of laps)</p></li>
</ul>
</section>
<section id="categorical-variables" class="level4">
<h4 class="anchored" data-anchor-id="categorical-variables">Categorical variables:</h4>
<ul>
<li><p><code>compound</code>: Type of tire used (SOFT, MEDIUM, HARD)</p></li>
<li><p><code>pit_in</code>: Whether a driver made a pit stop during a lap (binary: 0 = no pit stop, 1 = pit stop occured)</p></li>
</ul>
</section>
</section>
<section id="missing-data-in-lap_time" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-in-lap_time">Missing Data in <code>lap_time</code></h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_paper_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are  5  missing lap time values"</code></pre>
</div>
</div>
<p>The dataset contains five missing lap times. Out of 5 missing lap time records four records have a track status code of 41. However, no description of this code value is provided in the API. Thus, we assume that either the track was not fully cleared or conditions were not suitable for racing. The other missing record was due to a driver failing to complete a lap due to collision. Since the missing observations are less than 0.1% of the entire observation, we decided to drop these records.</p>
</section>
<section id="exploratory-data-analysis-visualization" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-visualization"><strong>Exploratory Data Analysis &amp; Visualization</strong></h2>
<p><strong>Distribution of Pit Stops by Lap</strong></p>
<p>This plot shows the frequency of pit stops across laps during the 2024 Miami Grand Prix. It helps visualize when teams tend to stop during the race. Many teams pitted to change tires during the first half of the race and the most common pit stop occurring around lap 28. This race was unique in that some drivers performed a one-stop strategy, while others went for a two-stop approach. These decisions were influenced by various factors such as track position, gaps to nearby drivers, tire condition, and more. Pit stops in the later stages of the race likely reflect either a two-stop strategy or an attempt to set the fastest lap and earn an extra point.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_paper_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Density of Lap Times by Team</strong></p>
<p>This plot shows the distribution of lap times for each team during the race. We can compare the performance and variability in lap times across different teams. For most teams, the lap times are generally under 100 seconds, with some laps approaching 110 seconds. These patterns are largely consistent across teams, though some, such as Mercedes and Williams, show a few outliers on the higher end, which indicates occasional slower laps.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_paper_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Distribution of Tire Life by Tire Compound</strong></p>
<p>The plot shows the distribution of tire life (measured in laps) for each tire compound used in the race. On average, hard tires lasted very slightly longer than medium tires. Since hard and medium compounds were the most commonly used in this race, we have limited data on soft tires, roughly a quarter as much. This resulted in a narrower distribution for the soft compound. The tire compound directly affects tire life, with a trade-off between performance (speed and grip) and durability. As a result, softer compounds tend to wear out more quickly than harder ones.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_paper_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="linear-regression-model" class="level1">
<h1>Linear Regression Model</h1>
<section id="research-questions" class="level2">
<h2 class="anchored" data-anchor-id="research-questions">Research questions</h2>
<ol type="1">
<li><p>Were drivers more likely to make pit stops when their lap time was longer and their tires were older compared to when their lap time was shorter and their tires were less used?</p></li>
<li><p>Were drivers more likely to make pit stops when their lap times were longer, their tires were older, and considering the type of tires they were using and their progress in the race?</p></li>
</ol>
</section>
<section id="linear-models" class="level2">
<h2 class="anchored" data-anchor-id="linear-models">Linear Models</h2>
<ul>
<li><strong>Model 1</strong>:</li>
</ul>
<p><span class="math display">\[\mathbb{E}(pit\_in \mid lap\_time,\ tyre\_life) = \beta_0 + \beta_1(lap\_time) + \beta_2(tyre\_life)\]</span></p>
<ul>
<li><strong>Model 2</strong>:</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}(pit\_in \mid lap\_time, \ lap\_number, \ compound, \ tyre\_life)  &amp;= \beta_0 + \beta_1(lap\_time) \\ &amp;+ \beta_2(lap\_number) + \beta_3(compound) \\ &amp;+ \beta_4(tyre\_life)
\end{aligned}
\]</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept) -0.422    0.0543       -7.77 1.74e-14
2 lap_time     0.00429  0.000537      7.98 3.63e-15
3 tyre_life    0.00243  0.000509      4.79 1.94e- 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  term           estimate std.error statistic  p.value
  &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)    -0.446    0.0544       -8.21 6.32e-16
2 lap_time        0.00468  0.000534      8.76 7.32e-18
3 lap_number     -0.00214  0.000387     -5.54 3.88e- 8
4 compoundMEDIUM  0.0117   0.00936       1.25 2.10e- 1
5 compoundSOFT    0.0312   0.0240        1.30 1.93e- 1
6 tyre_life       0.00519  0.000698      7.44 1.97e-13</code></pre>
</div>
</div>
<p>The regression results show that drivers were slightly more likely to make pit stops when their lap times were longer and their tires were older. In the extended model, lap time and tire age remained strong predictors and suggested that there are fewer stops later in the race with lap number having a slight negative effect. Tire compound had a small and non-significant effect. This indicates that tire compound did not meaningfully influence pit stop decisions when other factors were considered.</p>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross Validation</h2>
<p>Cross-validation is a statistical method used to evaluate how well a model performs by splitting the data into multiple subsets to train the model on some subsets and validate it on the remaining subsets.</p>
<p><strong>Goal</strong>: Provide a more reliable and unbiased estimate of a model’s performance predicting new data, in order to detect overfitting and improve model generalization</p>
<section id="dividing-data-into-test-set-and-training-set" class="level3">
<h3 class="anchored" data-anchor-id="dividing-data-into-test-set-and-training-set">Dividing data into test set and training set</h3>
<p><strong>k-fold CV</strong>: We can use k-fold cross-validation to estimate the typical error in our model predictions for new data:</p>
<ul>
<li>Divide the data into <span class="math inline">\(k\)</span> folds (or groups) of approximately equal size.</li>
<li>Repeat the following procedures for each fold <span class="math inline">\(j = 1,2,...,k\)</span>:
<ul>
<li>Remove fold <span class="math inline">\(j\)</span> from the data set.</li>
<li>Fit a model using the data in the other <span class="math inline">\(k-1\)</span> folds (training).</li>
<li>Use this model to predict the responses for the <span class="math inline">\(n_j\)</span> cases in fold <span class="math inline">\(j\)</span>: <span class="math inline">\(\hat{y}_1, ..., \hat{y}_{n_j}\)</span>.</li>
<li>Calculate the MAE/MSE for fold <span class="math inline">\(j\)</span> (testing):</li>
</ul></li>
<li>Combine this information into one measure of model quality</li>
</ul>
</section>
<section id="error-metric-to-use" class="level3">
<h3 class="anchored" data-anchor-id="error-metric-to-use">Error metric to use</h3>
<p><strong>Mean absolute error (MAE)</strong> of an estimator measures the absolute difference between the predicted values and the actual values in the dataset. Its advantage is that its</p>
<ul>
<li><span class="math inline">\(\text{MAE}_j = \frac{1}{n_j}\sum_{i=1}^{n_j} |y_i - \hat{y}_i|\)</span></li>
<li><span class="math inline">\(\text{CV}_{(k)} = \frac{1}{k} \sum_{j=1}^k \text{MAE}_j\)</span></li>
</ul>
<p><strong>Mean squared error (MSE)</strong> of an estimator measures the average squared difference between the predicted values and the actual values in the dataset.</p>
<ul>
<li><span class="math inline">\(\text{MSE}_j = \frac{1}{n_j}\sum_{i=1}^{n_j} (y_i - \hat{y}_i)^2\)</span></li>
<li><span class="math inline">\(\text{CV}_{(k)} = \frac{1}{k} \sum_{j=1}^k \text{MSE}_j\)</span></li>
</ul>
<section id="mae-vs.-mse" class="level4">
<h4 class="anchored" data-anchor-id="mae-vs.-mse">MAE vs.&nbsp;MSE</h4>
<p>The advantage of using MAE is that it’s more robust to outliers, giving equal weight to all errors. Thus, it’s more suitable when outliers are not a significant concern.</p>
<p>On the other hand, MSE gives more weight to larger errors than smaller ones, making it highly sensitive to outliers. MSE is more suitable when the risk of prediction mistakes is crucial and the goal is to minimize the risk of errors.</p>
<p>Since outliers are less of a concern for us as they don’t lead to any life threatening or other major issues, we prioritize models that are directly interpretable. Our data is less common and less familiar to many people, so we decided to choose a model based on MAE.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 mae     standard      0.0505</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 mae     standard      0.0587</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="k-fold-cv-implementation-for-different-values-of-k" class="level2">
<h2 class="anchored" data-anchor-id="k-fold-cv-implementation-for-different-values-of-k">k-fold CV implementation for different values of k</h2>
<section id="case-1-k5" class="level3">
<h3 class="anchored" data-anchor-id="case-1-k5">Case 1: k=5</h3>
<p><strong>Model 1</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 mae     standard   0.0507     5 0.00159 Preprocessor1_Model1
2 rmse    standard   0.152      5 0.00536 Preprocessor1_Model1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  splits            id    .metric .estimator .estimate .config          .notes  
  &lt;list&gt;            &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;            &lt;list&gt;  
1 &lt;split [884/222]&gt; Fold1 mae     standard      0.0477 Preprocessor1_M… &lt;tibble&gt;
2 &lt;split [885/221]&gt; Fold2 mae     standard      0.0560 Preprocessor1_M… &lt;tibble&gt;
3 &lt;split [885/221]&gt; Fold3 mae     standard      0.0528 Preprocessor1_M… &lt;tibble&gt;
4 &lt;split [885/221]&gt; Fold4 mae     standard      0.0486 Preprocessor1_M… &lt;tibble&gt;
5 &lt;split [885/221]&gt; Fold5 mae     standard      0.0485 Preprocessor1_M… &lt;tibble&gt;</code></pre>
</div>
</div>
<p>Based on the random folds above, MAE was best for fold 1 (0.048) and worst for fold 2 (0.056).</p>
<p><strong>Model 2</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 mae     standard   0.0592     5 0.00161 Preprocessor1_Model1
2 rmse    standard   0.150      5 0.00490 Preprocessor1_Model1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  splits            id    .metric .estimator .estimate .config          .notes  
  &lt;list&gt;            &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;            &lt;list&gt;  
1 &lt;split [884/222]&gt; Fold1 mae     standard      0.0533 Preprocessor1_M… &lt;tibble&gt;
2 &lt;split [885/221]&gt; Fold2 mae     standard      0.0621 Preprocessor1_M… &lt;tibble&gt;
3 &lt;split [885/221]&gt; Fold3 mae     standard      0.0617 Preprocessor1_M… &lt;tibble&gt;
4 &lt;split [885/221]&gt; Fold4 mae     standard      0.0585 Preprocessor1_M… &lt;tibble&gt;
5 &lt;split [885/221]&gt; Fold5 mae     standard      0.0606 Preprocessor1_M… &lt;tibble&gt;</code></pre>
</div>
</div>
<p>Based on the random folds above, MAE was best for fold 1 (0.053) and worst for fold 2 (0.062).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    mean      sd
   &lt;dbl&gt;   &lt;dbl&gt;
1 0.0507 0.00356</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    mean      sd
   &lt;dbl&gt;   &lt;dbl&gt;
1 0.0592 0.00360</code></pre>
</div>
</div>
<p>In-sample and 5-fold CV MAE and standard deviation for both models.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 19%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">In-sample MAE</th>
<th style="text-align: right;">5-fold CV MAE</th>
<th style="text-align: right;">In-sample SD</th>
<th style="text-align: right;">5-fold CV SD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>model_1</code></td>
<td style="text-align: right;">0.05045</td>
<td style="text-align: right;">0.05073</td>
<td style="text-align: right;">0.15247</td>
<td style="text-align: right;">0.00356</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>model_2</code></td>
<td style="text-align: right;">0.05975</td>
<td style="text-align: right;">0.05922</td>
<td style="text-align: right;">0.15035</td>
<td style="text-align: right;">0.00360</td>
</tr>
</tbody>
</table>
<p>5-fold cross-validation was used to assess the performance of two models predicting pit stops. Model 1, using only lap time and tire life, achieved a mean MAE of 0.05073 with a low standard deviation (0.00356). Model 2, which adds lap number and tire compound, had a higher mean MAE of 0.05922 with a similar standard deviation (0.00360).</p>
<p>Although Model 2 includes more predictors, it performed slightly worse than Model 1 in both cross-validation and in-sample metrics. This suggests that the additional variables do not improve prediction. Model 1 is therefore more accurate and efficient for predicting pit stops.</p>
</section>
<section id="case-2-k10" class="level3">
<h3 class="anchored" data-anchor-id="case-2-k10">Case 2: k=10</h3>
<p><strong>Model 1</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 mae     standard   0.0510    10 0.00294 Preprocessor1_Model1
2 rmse    standard   0.150     10 0.0109  Preprocessor1_Model1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
   splits            id     .metric .estimator .estimate .config        .notes  
   &lt;list&gt;            &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;list&gt;  
 1 &lt;split [995/111]&gt; Fold01 mae     standard      0.0368 Preprocessor1… &lt;tibble&gt;
 2 &lt;split [995/111]&gt; Fold02 mae     standard      0.0544 Preprocessor1… &lt;tibble&gt;
 3 &lt;split [995/111]&gt; Fold03 mae     standard      0.0614 Preprocessor1… &lt;tibble&gt;
 4 &lt;split [995/111]&gt; Fold04 mae     standard      0.0472 Preprocessor1… &lt;tibble&gt;
 5 &lt;split [995/111]&gt; Fold05 mae     standard      0.0379 Preprocessor1… &lt;tibble&gt;
 6 &lt;split [995/111]&gt; Fold06 mae     standard      0.0602 Preprocessor1… &lt;tibble&gt;
 7 &lt;split [996/110]&gt; Fold07 mae     standard      0.0600 Preprocessor1… &lt;tibble&gt;
 8 &lt;split [996/110]&gt; Fold08 mae     standard      0.0434 Preprocessor1… &lt;tibble&gt;
 9 &lt;split [996/110]&gt; Fold09 mae     standard      0.0505 Preprocessor1… &lt;tibble&gt;
10 &lt;split [996/110]&gt; Fold10 mae     standard      0.0581 Preprocessor1… &lt;tibble&gt;</code></pre>
</div>
</div>
<p>Based on the random folds above, the MAE was best for fold 1 with an MAE of approximately 0.037 and worst for fold 3 with an MAE of 0.061 approximately.</p>
<p><strong>Model 2</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 mae     standard   0.0594    10 0.00262 Preprocessor1_Model1
2 rmse    standard   0.148     10 0.0104  Preprocessor1_Model1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
   splits            id     .metric .estimator .estimate .config        .notes  
   &lt;list&gt;            &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;list&gt;  
 1 &lt;split [995/111]&gt; Fold01 mae     standard      0.0436 Preprocessor1… &lt;tibble&gt;
 2 &lt;split [995/111]&gt; Fold02 mae     standard      0.0616 Preprocessor1… &lt;tibble&gt;
 3 &lt;split [995/111]&gt; Fold03 mae     standard      0.0698 Preprocessor1… &lt;tibble&gt;
 4 &lt;split [995/111]&gt; Fold04 mae     standard      0.0566 Preprocessor1… &lt;tibble&gt;
 5 &lt;split [995/111]&gt; Fold05 mae     standard      0.0518 Preprocessor1… &lt;tibble&gt;
 6 &lt;split [995/111]&gt; Fold06 mae     standard      0.0658 Preprocessor1… &lt;tibble&gt;
 7 &lt;split [996/110]&gt; Fold07 mae     standard      0.0655 Preprocessor1… &lt;tibble&gt;
 8 &lt;split [996/110]&gt; Fold08 mae     standard      0.0521 Preprocessor1… &lt;tibble&gt;
 9 &lt;split [996/110]&gt; Fold09 mae     standard      0.0601 Preprocessor1… &lt;tibble&gt;
10 &lt;split [996/110]&gt; Fold10 mae     standard      0.0671 Preprocessor1… &lt;tibble&gt;</code></pre>
</div>
</div>
<p>Based on the random folds above, MAE was best for fold 1 (0.044) and worst for fold 3 (0.070).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    mean      sd
   &lt;dbl&gt;   &lt;dbl&gt;
1 0.0510 0.00931</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    mean      sd
   &lt;dbl&gt;   &lt;dbl&gt;
1 0.0594 0.00829</code></pre>
</div>
</div>
<p>In-sample and 10-fold CV MAE and standard deviation for both models.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 18%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">In-sample MAE</th>
<th style="text-align: right;">10-fold CV MAE</th>
<th style="text-align: right;">In-sample SD</th>
<th style="text-align: right;">10-fold CV SD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>model_1</code></td>
<td style="text-align: right;">0.05045</td>
<td style="text-align: right;">0.05100</td>
<td style="text-align: right;">0.15247</td>
<td style="text-align: right;">0.00931</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>model_2</code></td>
<td style="text-align: right;">0.05975</td>
<td style="text-align: right;">0.05939</td>
<td style="text-align: right;">0.15035</td>
<td style="text-align: right;">0.00829</td>
</tr>
</tbody>
</table>
<p>With 10-fold cross-validation, Model 1 had a mean MAE of 0.0510, while Model 2 had a slightly higher MAE of 0.0594. Both models showed low standard deviations approximately 0.009. As in the 5-fold case, Model 1 remained slightly more accurate and stable than Model 2.</p>
</section>
<section id="case-3-k-20" class="level3">
<h3 class="anchored" data-anchor-id="case-3-k-20">Case 3: k = 20</h3>
<p><strong>Model 1</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 mae     standard   0.0509    20 0.00399 Preprocessor1_Model1
2 rmse    standard   0.140     20 0.0142  Preprocessor1_Model1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 7
   splits            id     .metric .estimator .estimate .config        .notes  
   &lt;list&gt;            &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;list&gt;  
 1 &lt;split [1050/56]&gt; Fold01 mae     standard      0.0451 Preprocessor1… &lt;tibble&gt;
 2 &lt;split [1050/56]&gt; Fold02 mae     standard      0.0519 Preprocessor1… &lt;tibble&gt;
 3 &lt;split [1050/56]&gt; Fold03 mae     standard      0.0509 Preprocessor1… &lt;tibble&gt;
 4 &lt;split [1050/56]&gt; Fold04 mae     standard      0.0658 Preprocessor1… &lt;tibble&gt;
 5 &lt;split [1050/56]&gt; Fold05 mae     standard      0.0439 Preprocessor1… &lt;tibble&gt;
 6 &lt;split [1050/56]&gt; Fold06 mae     standard      0.0412 Preprocessor1… &lt;tibble&gt;
 7 &lt;split [1051/55]&gt; Fold07 mae     standard      0.0602 Preprocessor1… &lt;tibble&gt;
 8 &lt;split [1051/55]&gt; Fold08 mae     standard      0.0429 Preprocessor1… &lt;tibble&gt;
 9 &lt;split [1051/55]&gt; Fold09 mae     standard      0.0402 Preprocessor1… &lt;tibble&gt;
10 &lt;split [1051/55]&gt; Fold10 mae     standard      0.0263 Preprocessor1… &lt;tibble&gt;
11 &lt;split [1051/55]&gt; Fold11 mae     standard      0.0266 Preprocessor1… &lt;tibble&gt;
12 &lt;split [1051/55]&gt; Fold12 mae     standard      0.0585 Preprocessor1… &lt;tibble&gt;
13 &lt;split [1051/55]&gt; Fold13 mae     standard      0.0704 Preprocessor1… &lt;tibble&gt;
14 &lt;split [1051/55]&gt; Fold14 mae     standard      0.0274 Preprocessor1… &lt;tibble&gt;
15 &lt;split [1051/55]&gt; Fold15 mae     standard      0.0302 Preprocessor1… &lt;tibble&gt;
16 &lt;split [1051/55]&gt; Fold16 mae     standard      0.0825 Preprocessor1… &lt;tibble&gt;
17 &lt;split [1051/55]&gt; Fold17 mae     standard      0.0591 Preprocessor1… &lt;tibble&gt;
18 &lt;split [1051/55]&gt; Fold18 mae     standard      0.0429 Preprocessor1… &lt;tibble&gt;
19 &lt;split [1051/55]&gt; Fold19 mae     standard      0.0611 Preprocessor1… &lt;tibble&gt;
20 &lt;split [1051/55]&gt; Fold20 mae     standard      0.0901 Preprocessor1… &lt;tibble&gt;</code></pre>
</div>
</div>
<p>Based on the random folds above, MAE was best for fold 10 (0.026) and worst for fold 20 (0.090).</p>
<p><strong>Model 2</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 mae     standard   0.0593    20 0.00398 Preprocessor1_Model1
2 rmse    standard   0.139     20 0.0134  Preprocessor1_Model1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 7
   splits            id     .metric .estimator .estimate .config        .notes  
   &lt;list&gt;            &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;list&gt;  
 1 &lt;split [1050/56]&gt; Fold01 mae     standard      0.0508 Preprocessor1… &lt;tibble&gt;
 2 &lt;split [1050/56]&gt; Fold02 mae     standard      0.0623 Preprocessor1… &lt;tibble&gt;
 3 &lt;split [1050/56]&gt; Fold03 mae     standard      0.0564 Preprocessor1… &lt;tibble&gt;
 4 &lt;split [1050/56]&gt; Fold04 mae     standard      0.0755 Preprocessor1… &lt;tibble&gt;
 5 &lt;split [1050/56]&gt; Fold05 mae     standard      0.0596 Preprocessor1… &lt;tibble&gt;
 6 &lt;split [1050/56]&gt; Fold06 mae     standard      0.0535 Preprocessor1… &lt;tibble&gt;
 7 &lt;split [1051/55]&gt; Fold07 mae     standard      0.0652 Preprocessor1… &lt;tibble&gt;
 8 &lt;split [1051/55]&gt; Fold08 mae     standard      0.0492 Preprocessor1… &lt;tibble&gt;
 9 &lt;split [1051/55]&gt; Fold09 mae     standard      0.0474 Preprocessor1… &lt;tibble&gt;
10 &lt;split [1051/55]&gt; Fold10 mae     standard      0.0324 Preprocessor1… &lt;tibble&gt;
11 &lt;split [1051/55]&gt; Fold11 mae     standard      0.0347 Preprocessor1… &lt;tibble&gt;
12 &lt;split [1051/55]&gt; Fold12 mae     standard      0.0630 Preprocessor1… &lt;tibble&gt;
13 &lt;split [1051/55]&gt; Fold13 mae     standard      0.0818 Preprocessor1… &lt;tibble&gt;
14 &lt;split [1051/55]&gt; Fold14 mae     standard      0.0362 Preprocessor1… &lt;tibble&gt;
15 &lt;split [1051/55]&gt; Fold15 mae     standard      0.0405 Preprocessor1… &lt;tibble&gt;
16 &lt;split [1051/55]&gt; Fold16 mae     standard      0.0838 Preprocessor1… &lt;tibble&gt;
17 &lt;split [1051/55]&gt; Fold17 mae     standard      0.0652 Preprocessor1… &lt;tibble&gt;
18 &lt;split [1051/55]&gt; Fold18 mae     standard      0.0537 Preprocessor1… &lt;tibble&gt;
19 &lt;split [1051/55]&gt; Fold19 mae     standard      0.0724 Preprocessor1… &lt;tibble&gt;
20 &lt;split [1051/55]&gt; Fold20 mae     standard      0.102  Preprocessor1… &lt;tibble&gt;</code></pre>
</div>
</div>
<p>Based on the random folds above, MAE was best for fold 10 (0.032) and worst for fold 20 (0.101).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    mean     sd
   &lt;dbl&gt;  &lt;dbl&gt;
1 0.0509 0.0178</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    mean     sd
   &lt;dbl&gt;  &lt;dbl&gt;
1 0.0593 0.0178</code></pre>
</div>
</div>
<p>In-sample and 20-fold CV MAE and standard deviation for both models.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 18%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">In-sample MAE</th>
<th style="text-align: right;">20-fold CV MAE</th>
<th style="text-align: right;">In-sample SD</th>
<th style="text-align: right;">20-fold CV SD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>model_1</code></td>
<td style="text-align: right;">0.05045</td>
<td style="text-align: right;">0.05086</td>
<td style="text-align: right;">0.15247</td>
<td style="text-align: right;">0.01785</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>model_2</code></td>
<td style="text-align: right;">0.05975</td>
<td style="text-align: right;">0.05925</td>
<td style="text-align: right;">0.15035</td>
<td style="text-align: right;">0.01781</td>
</tr>
</tbody>
</table>
<p>In the 20-fold CV setup, Model 1 performed better than Model 2 with a lower mean MAE, 0.05086 and 0.05925, respectively. Even with increased fold, the simpler model generalized better across the dataset.</p>
</section>
<section id="comparison-between-different-values-of-k" class="level3">
<h3 class="anchored" data-anchor-id="comparison-between-different-values-of-k">Comparison between different values of k</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">In-sample MAE</th>
<th style="text-align: right;">5-fold CV MAE</th>
<th style="text-align: right;">10-fold CV MAE</th>
<th style="text-align: right;">20-fold CV MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>model_1</code></td>
<td style="text-align: right;">0.05045</td>
<td style="text-align: right;">0.05073</td>
<td style="text-align: right;">0.05100</td>
<td style="text-align: right;">0.05086</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>model_2</code></td>
<td style="text-align: right;">0.05975</td>
<td style="text-align: right;">0.05922</td>
<td style="text-align: right;">0.05939</td>
<td style="text-align: right;">0.05925</td>
</tr>
</tbody>
</table>
<p>Across all cross-validation settings (5, 10, and 20-fold), Model 1 consistently showed lower MAE than Model 2. The differences were small but consistent and this suggests that Model 1 is a better model than Model 2 in predicting pit-stops.</p>
<p>Therefore, our final model based on the smallest CV error is:</p>
<p><span class="math display">\[\mathbb{E}(pit\_in \mid lap\_time,\ tyre\_life) = \beta_0 + \beta_1(lap\_time) + \beta_2(tyre\_life)\]</span></p>
<div style="page-break-after: always;"></div>
</section>
</section>
</section>
<section id="logistic-regression-model" class="level1">
<h1>Logistic Regression Model</h1>
<section id="variables-of-interest-1" class="level2">
<h2 class="anchored" data-anchor-id="variables-of-interest-1">Variables of Interest</h2>
<section id="predictors" class="level3">
<h3 class="anchored" data-anchor-id="predictors">Predictors:</h3>
<ul>
<li><code>lap_time</code>: Recorded time to complete a lap (seconds).</li>
<li><code>lap_number</code>: Lap number from which the telemetry data was recorded (number of laps).</li>
<li><code>tyre_life</code>: Number of laps completed on a set of tires (number of laps).</li>
<li><code>compound</code>: Type of tire used (SOFT, MEDIUM, HARD).</li>
</ul>
</section>
<section id="response-variable" class="level3">
<h3 class="anchored" data-anchor-id="response-variable">Response Variable:</h3>
<ul>
<li><p><code>pit_in</code>: Whether a driver made a pit stop during a lap where 1 indicates pit stop occurred, and 0 otherwise</p>
<p><span class="math display">\[\begin{align*}
Y_i &amp;= \begin{cases} 1 &amp; \text{ if a driver pitted on a lap } \\ 0 &amp; \text{ otherwise (i.e., the driver did not pit on lap)} \end{cases}
\end{align*}\]</span></p></li>
</ul>
</section>
</section>
<section id="our-logistic-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="our-logistic-regression-model">Our Logistic Regression Model</h2>
<p>We are interested in determining the probability of making a pit stop during the 2024 Miami Grand Prix, considering factors such as lap time, track progress, tire age, and the type of tire used.</p>
<p><span class="math display">\[
\begin{aligned}
\log(odds(pit\_in \mid lap\_time, \ lap\_number, \ tyre\_life, \ compound)) &amp;= \beta_0 + \beta_1 (lap\_time) \\ &amp;+ \beta_2(lap\_number) + \beta_3 (tyre\_life) \\ &amp;+ \beta_4 \ I(compound = MEDIUM) \\ &amp;+ \beta_5 \ I(compound = SOFT)
\end{aligned}
\]</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
NULL

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -18.48162    2.27137  -8.137 4.06e-16 ***
lap_time         0.13739    0.02007   6.846 7.58e-12 ***
lap_number      -0.16001    0.03630  -4.408 1.04e-05 ***
tyre_life        0.27508    0.04580   6.006 1.91e-09 ***
compoundMEDIUM   0.49495    0.49718   0.996    0.319    
compoundSOFT     1.86135    1.17923   1.578    0.114    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 261.16  on 1105  degrees of freedom
Residual deviance: 176.46  on 1100  degrees of freedom
AIC: 188.46

Number of Fisher Scoring iterations: 8</code></pre>
</div>
</div>
<section id="interpretation-of-exponentiated-hatbeta-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-exponentiated-hatbeta-coefficients">Interpretation of exponentiated <span class="math inline">\(\hat{\beta}\)</span> coefficients</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept)       lap_time     lap_number      tyre_life compoundMEDIUM 
  9.408757e-09   1.147280e+00   8.521343e-01   1.316630e+00   1.640419e+00 
  compoundSOFT 
  6.432386e+00 </code></pre>
</div>
</div>
<ul>
<li><p><span class="math inline">\(\exp(\beta_0)\)</span>: The odds of a driver making a pit stop during a lap, when lap time is 0 seconds, lap number is 0, 0 laps have been completed on the current set of tires, and the HARD compound is, is approximately <span class="math inline">\(9.4088 \times 10^{-9}\)</span>.</p></li>
<li><p><span class="math inline">\(\exp(\beta_1)\)</span>: For every of 1 second increase in lap time, the odds of a driver pitting increase by a factor of 1.1473.</p></li>
<li><p><span class="math inline">\(\exp(\beta_2)\)</span>: For every additional lap (i.e., increase of 1 in the lap number), we expect the odds of a driver pitting to increase by a factor of 0.8521.</p></li>
<li><p><span class="math inline">\(\exp(\beta_3)\)</span>: For each additional lap completed on the current set of tires, the odds of a driver pitting increase by a factor of 1.3166.</p></li>
<li><p><span class="math inline">\(\exp(\beta_4)\)</span>: When using MEDIUM compound tires instead of HARD, the odds of a driver pitting increase by a factor of 1.6404, holding all other variables constant.</p></li>
<li><p><span class="math inline">\(\exp(\beta_5)\)</span>: When using SOFT compound tires instead of HARD, we expect the odds of a driver pitting to increase by a factor of 6.4324, holding all other variables constant.</p></li>
</ul>
<section id="mathematically-derive-expbeta_1" class="level4">
<h4 class="anchored" data-anchor-id="mathematically-derive-expbeta_1">Mathematically derive <span class="math inline">\(\exp(\beta_1)\)</span></h4>
<p><span class="math display">\[
\begin{aligned}
&amp;\log(odds(pit\_in \mid lap\_time = a)) = -18.4816 + 0.1374a
\\
\\
&amp;\log(odds(pit\_in \mid lap\_time = a+1)) = -18.4816 + 0.1374(a+1)
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
&amp; \log\left( \frac{odds(pit\_in \mid lap\_time = a+1)}{odds(pit\_in \mid lap\_time = a)} \right)\\
&amp;= \log(odds(pit\_in \mid lap\_time = a+1)) - \log(odds(pit\_in \mid lap\_time = a)) \\
&amp;= (-18.4816 + 0.1374(a+1)) - (-18.4816 + 0.1374) \\
&amp;= 0.1374  \\
&amp;= \hat{\beta_1}
\end{aligned}
\]</span></p>
<p>Therefore, <span class="math inline">\(\exp(\beta_1) = e^{0.1374} = 1.1473\)</span></p>
</section>
</section>
<section id="predicting-high-probability-of-a-pit-stop" class="level3">
<h3 class="anchored" data-anchor-id="predicting-high-probability-of-a-pit-stop">Predicting High Probability of a Pit Stop</h3>
<p>To predict a probability of a driver making a pit stop that is very close to 1, we need to input extreme values for the predictors. Based on the five-number summary of our data, we use the following scenario: a lap time of 148.74 seconds, lap number 57, SOFT compound, and a tire age of 45 laps.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    lap_time        lap_number      compound     tyre_life    
 Min.   : 90.63   Min.   : 1.00   HARD  :500   Min.   : 1.00  
 1st Qu.: 92.38   1st Qu.:14.00   MEDIUM:562   1st Qu.: 7.00  
 Median : 93.28   Median :28.00   SOFT  : 44   Median :13.50  
 Mean   : 96.00   Mean   :28.62                Mean   :14.78  
 3rd Qu.: 94.29   3rd Qu.:43.00                3rd Qu.:22.00  
 Max.   :148.74   Max.   :57.00                Max.   :45.00  
     pit_in        pit_in_fac
 Min.   :0.00000   0:1078    
 1st Qu.:0.00000   1:  28    
 Median :0.00000             
 Mean   :0.02532             
 3rd Qu.:0.00000             
 Max.   :1.00000             </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        1 
0.7308921 </code></pre>
</div>
</div>
<p>Using our logistic regression model, we estimate the probability of a pit stop under these conditions to be approximately 0.731. This indicates a high likelihood of a pit stop given these extreme race conditions.</p>
</section>
<section id="predicting-pit-stops-with-our-logistic-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="predicting-pit-stops-with-our-logistic-regression-model">Predicting Pit Stops with our Logistic Regression Model</h3>
<ul>
<li><p>Estimate the probability of a driver making a pit stop on a lap with the following conditions: 96.00 seconds lap time, 28th lap, 14.78 laps completed on a set of HARD tires.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        1 
0.5008283 </code></pre>
</div>
</div></li>
</ul>
<p>There is approximately a 50.08% probability that a driver will make a pit stop on this lap when using HARD tires, holding all other variables constant.</p>
<!-- -->
<ul>
<li><p>Estimate the probability of a driver making a pit stop on a lap under the same conditions as above but using a set of MEDIUM tires.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        1 
0.5013559 </code></pre>
</div>
</div></li>
</ul>
<p>With MEDIUM tires, the probability of making a pit stop increases to 50.14%.</p>
<!-- -->
<ul>
<li><p>Estimate the probability of a driver making a pit stop on a lap under the same conditions as above but using a set of SOFT tires.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        1 
0.5052337 </code></pre>
</div>
</div></li>
</ul>
<p>With SOFT tires, the probability increases slightly to 50.52%.</p>
<p>While all the other variables stay the same, we predict that the probability a driver to made a pit stop is higher if the driver is on a set of SOFT tires compared to other compounds.</p>
</section>
</section>
<section id="proscons-of-logistic-regression-vs.-regular-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="proscons-of-logistic-regression-vs.-regular-linear-regression">Pros/Cons of logistic regression vs.&nbsp;regular linear regression</h2>
<section id="logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Pros</strong></td>
<td><p>Since logistic regression is based on a Bernoulli/binomial likelihood, it is a natural model for binary outcomes.</p>
<p>Coefficients are interpretable in terms of odds ratios (with log-odds as the linear predictor).</p></td>
</tr>
<tr class="even">
<td><strong>Cons</strong></td>
<td>The relationship between predictors and the probability is not linear.</td>
</tr>
</tbody>
</table>
</section>
<section id="linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="linear-regression">Linear Regression</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 84%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Pros</strong></td>
<td><p>Straightforward linear regression</p>
<p>Easy to interpret the coefficients</p></td>
</tr>
<tr class="even">
<td><strong>Cons</strong></td>
<td>Cannot gaurantee that the predicted probabilities to be between 0 and 1.</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The linear and logistic regression models provide a practical method for predicting pit-stop laps based on multiple factors, while k-fold cross-validation offers an approach for selecting the most optimized models. However, the prediction results from the logistic model were somewhat limited, with predictions averaging around 50% even with extreme parameters, making it challenging to accurately predict pit-stop laps. This limitation is understandable because predicting pit-stop timing in real races is one of the most crucial and difficult decisions in race strategy.</p>
<p>For future studies, we could consider additional factors that influence car speeds or tire management, as well as apply methods that are capable of handling more complex models to observed more detailed and comprehensive analyses.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>